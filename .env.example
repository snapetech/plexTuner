# Plex Tuner — provider credentials and paths
# Copy this file to .env and fill in your values. Never commit .env.
#   cp .env.example .env

# --------------- Xtream / IPTV login (e.g. Strong 8K style) ---------------
# Username and password from your provider.
# Optional: read from a subscription file (e.g. k3s iptv.subscription.2026.txt) if user/pass unset.
# PLEX_TUNER_SUBSCRIPTION_FILE=$HOME/Documents/iptv.subscription.2026.txt
PLEX_TUNER_PROVIDER_USER=your_username
PLEX_TUNER_PROVIDER_PASS=your_password

# Host/URL: one base URL, or comma-separated list to probe (first HTTP 200 used).
# Cloudflare is only flagged when Server: cloudflare or challenge page; add all known hosts so a valid one can be chosen.
PLEX_TUNER_PROVIDER_URL=http://your-provider-host.example.com
# PLEX_TUNER_PROVIDER_URLS=http://host1.com,http://host2.com,http://backup.com

# --------------- Optional: full M3U URL ---------------
# If you prefer to paste the full SmartTV/M3U [TS] URL instead of host+user+pass, set it here.
# Otherwise we build: PROVIDER_URL/get.php?username=USER&password=PASS&type=m3u_plus&output=ts
# PLEX_TUNER_M3U_URL=http://host/get.php?username=USER&password=PASS&type=m3u_plus&output=ts

# --------------- Paths (optional) ---------------
# PLEX_TUNER_CATALOG=./catalog.json
# PLEX_TUNER_MOUNT=/mnt/vodfs
# PLEX_TUNER_CACHE=/var/cache/plextuner

# --------------- Live tuner (optional) ---------------
# PLEX_TUNER_TUNER_COUNT=2
# Max channels in lineup/guide. Plex DVR fails to save lineup above ~480; we cap at 480 by default. Set to 0 to use default.
# PLEX_TUNER_LINEUP_MAX_CHANNELS=480
# Device ID and friendly name shown in Plex Live TV tuner list
# PLEX_TUNER_DEVICE_ID=plextuner01
# PLEX_TUNER_FRIENDLY_NAME=SportsA

# --------------- HDHomeRun Network Mode (optional) ---------------
# Enable native HDHomeRun protocol (UDP 65001 + TCP 65001) instead of HTTP
# This bypasses the Plex Live TV startup race by using native HDHomeRun protocol
# PLEX_TUNER_HDHR_NETWORK_MODE=false
# Device ID (auto-generated if not set)
# PLEX_TUNER_HDHR_DEVICE_ID=12345678
# Tuner count for HDHomeRun mode
# PLEX_TUNER_HDHR_TUNER_COUNT=2

# Stream buffering: default auto (adaptive when transcoding). 0 = off. Or fixed bytes e.g. 2097152 = 2 MiB.
# PLEX_TUNER_STREAM_BUFFER_BYTES=auto
# Stream transcoding: off = remux only; on = always transcode (libx264/aac); auto = probe with ffprobe and transcode only when codec not Plex-friendly (e.g. HEVC/VP9).
# PLEX_TUNER_STREAM_TRANSCODE=off
# Optional: override ffmpeg binary path (useful if system ffmpeg is broken/crashes on HLS inputs)
# PLEX_TUNER_FFMPEG_PATH=/opt/ffmpeg-static/current/ffmpeg
# Web-safe live startup (Plex Live TV race hardening): bootstrap TS + startup gate + optional null TS keepalive.
# Useful when Plex opens a session but internal DASH/HLS manifests 404 ("Failed to find consumer").
# PLEX_TUNER_WEBSAFE_BOOTSTRAP=true
# PLEX_TUNER_WEBSAFE_BOOTSTRAP_ALL=false
# PLEX_TUNER_WEBSAFE_BOOTSTRAP_SECONDS=0.35
# PLEX_TUNER_WEBSAFE_STARTUP_MIN_BYTES=65536
# PLEX_TUNER_WEBSAFE_STARTUP_MAX_BYTES=524288
# PLEX_TUNER_WEBSAFE_STARTUP_TIMEOUT_MS=30000
# PLEX_TUNER_WEBSAFE_REQUIRE_GOOD_START=false
# Null TS keepalive while startup gate waits on upstream/ffmpeg bytes (PID 0x1FFF at low rate)
# PLEX_TUNER_WEBSAFE_NULL_TS_KEEPALIVE=false
# PLEX_TUNER_WEBSAFE_NULL_TS_KEEPALIVE_MS=100
# PLEX_TUNER_WEBSAFE_NULL_TS_KEEPALIVE_PACKETS=1
# PAT+PMT keepalive: send real MPEG-TS program-structure packets (PAT+PMT) while the startup gate
# waits. Unlike null TS (PID 0x1FFF), PAT/PMT carry the program map Plex's DASH packager needs to
# instantiate its consumer before the first IDR frame arrives — directly preventing the
# "Failed to find consumer" / dash_init_404 startup race.
# PIDs match ffmpeg mpegts defaults: PMT=0x1000, video=0x0100 (H.264), audio=0x0101 (AAC).
# PLEX_TUNER_WEBSAFE_PROGRAM_KEEPALIVE=false
# PLEX_TUNER_WEBSAFE_PROGRAM_KEEPALIVE_MS=500
# Only include channels that have EPG (tvg-id) in catalog; unset or false = include all
# PLEX_TUNER_LIVE_EPG_ONLY=false
# EPG prune: guide.xml and M3U export only include channels with tvg-id (reduces noise).
# PLEX_TUNER_EPG_PRUNE_UNLINKED=false
# Smoketest: at index time probe each channel's primary stream URL and drop failures.
# PLEX_TUNER_SMOKETEST_ENABLED=false
# PLEX_TUNER_SMOKETEST_TIMEOUT=8s
# PLEX_TUNER_SMOKETEST_CONCURRENCY=10
# Only fetch live channels from API (skip VOD/series); faster. Unset = full aggregation like xtream-to-m3u.js
# PLEX_TUNER_LIVE_ONLY=false
# Base URL Plex will use to reach this tuner (required for "run" / systemd). Use your server IP or hostname.
# PLEX_TUNER_BASE_URL=http://192.168.1.10:5004
# Optional: use an existing real XMLTV feed instead of the built-in placeholder guide.
# plex-tuner will fetch it, keep only channels in the live catalog, and remap programme channel IDs
# to its local guide numbers so Plex gets real guide listings.
# PLEX_TUNER_XMLTV_URL=http://iptv-m3u-server.plex.svc/xmltv.xml
# PLEX_TUNER_XMLTV_TIMEOUT=45s
# Cache the remapped XMLTV response to avoid hammering the upstream on every Plex metadata refresh.
# PLEX_TUNER_XMLTV_CACHE_TTL=10m

# --------------- Smoketest cache (optional) ---------------
# Persist smoketest probe results across runs to avoid re-probing recently-tested channels.
# PLEX_TUNER_SMOKETEST_CACHE_FILE=/var/cache/plextuner/smoketest.json
# PLEX_TUNER_SMOKETEST_CACHE_TTL=4h
